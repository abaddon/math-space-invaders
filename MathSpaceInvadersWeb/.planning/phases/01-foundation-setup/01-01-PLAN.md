---
phase: 01-foundation-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - e2e/tsconfig.json
  - playwright.config.ts
  - e2e/features/smoke/smoke.feature
  - e2e/features/smoke/steps.ts
  - e2e/support/fixtures.ts
autonomous: true

must_haves:
  truths:
    - "Developer can run npm install without errors after dependency additions"
    - "Developer can run npx bddgen and see test file generation succeed"
    - "e2e directory structure exists with correct subdirectories"
    - "TypeScript compiles e2e files without errors"
  artifacts:
    - path: "package.json"
      provides: "playwright-bdd and @playwright/test dependencies"
      contains: "playwright-bdd"
    - path: "e2e/tsconfig.json"
      provides: "TypeScript config for E2E tests"
      contains: "compilerOptions"
    - path: "playwright.config.ts"
      provides: "Playwright + BDD configuration"
      contains: "defineBddConfig"
    - path: "e2e/features/smoke/smoke.feature"
      provides: "Minimal feature file for verification"
      contains: "Feature:"
    - path: "e2e/support/fixtures.ts"
      provides: "Playwright BDD test fixtures"
      contains: "createBdd"
  key_links:
    - from: "playwright.config.ts"
      to: "e2e/features/**/*.feature"
      via: "defineBddConfig paths"
      pattern: "paths.*features"
    - from: "playwright.config.ts"
      to: "e2e/features/**/*.ts"
      via: "defineBddConfig require"
      pattern: "require.*\\.ts"
---

<objective>
Install playwright-bdd and @playwright/test, create the e2e directory structure, and configure both Playwright and BDD for the project.

Purpose: Establish the foundation for all E2E tests. Without this infrastructure, no tests can run.
Output: Working test infrastructure where `npx bddgen` succeeds and generates test files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-CONTEXT.md
@.planning/research/ARCHITECTURE.md
@.planning/research/SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create directory structure</name>
  <files>
    - package.json
    - e2e/tsconfig.json
    - e2e/support/.gitkeep
    - e2e/pages/.gitkeep
    - e2e/features/onboarding/.gitkeep
    - e2e/features/playing/.gitkeep
    - e2e/features/social/.gitkeep
  </files>
  <action>
    1. Install playwright-bdd and Playwright:
       ```bash
       npm install -D playwright-bdd @playwright/test
       npx playwright install chromium
       ```

    2. Create e2e directory structure per ARCHITECTURE.md research:
       ```
       e2e/
       ├── features/
       │   ├── onboarding/    # Auth-related features (future)
       │   ├── playing/       # Gameplay features (future)
       │   ├── social/        # Team/leaderboard features (future)
       │   └── smoke/         # Smoke test (this phase)
       ├── pages/             # Page Objects (future phases)
       ├── support/           # Fixtures, helpers
       └── tsconfig.json
       ```

    3. Create e2e/tsconfig.json:
       ```json
       {
         "extends": "../tsconfig.json",
         "compilerOptions": {
           "target": "ES2022",
           "module": "ESNext",
           "moduleResolution": "bundler",
           "types": ["node"],
           "esModuleInterop": true,
           "skipLibCheck": true,
           "strict": true,
           "noEmit": true
         },
         "include": ["**/*.ts"],
         "exclude": ["node_modules"]
       }
       ```

    Note: Use ESNext module and bundler resolution to match the project's Vite/ESM setup. Do NOT use CommonJS patterns.
  </action>
  <verify>
    - `npm ls playwright-bdd` shows ^8.4.2 or later installed
    - `npm ls @playwright/test` shows ^1.50 or later installed
    - `ls -la e2e/` shows features/, pages/, support/ directories
    - `cat e2e/tsconfig.json` shows valid JSON config
  </verify>
  <done>Dependencies installed, directory structure created, e2e/tsconfig.json exists</done>
</task>

<task type="auto">
  <name>Task 2: Configure Playwright with BDD integration</name>
  <files>
    - playwright.config.ts
    - e2e/support/fixtures.ts
  </files>
  <action>
    1. Create playwright.config.ts at project root with defineBddConfig:
       ```typescript
       import { defineConfig, devices } from '@playwright/test';
       import { defineBddConfig } from 'playwright-bdd';

       const testDir = defineBddConfig({
         paths: ['e2e/features/**/*.feature'],
         require: ['e2e/features/**/*.ts', 'e2e/support/**/*.ts'],
       });

       export default defineConfig({
         testDir,
         fullyParallel: true,
         forbidOnly: !!process.env.CI,
         retries: process.env.CI ? 2 : 0,
         workers: process.env.CI ? 1 : undefined,
         reporter: [
           ['line'],
           ['html', { open: 'always', outputFolder: 'playwright-report' }],
         ],
         outputDir: 'test-results',

         use: {
           baseURL: 'http://localhost:5173',
           trace: 'on-first-retry',
           screenshot: 'only-on-failure',
           viewport: { width: 1920, height: 1080 },
           actionTimeout: 10000,
           headless: true,
         },

         projects: [
           {
             name: 'chromium',
             use: { ...devices['Desktop Chrome'] },
           },
         ],

         webServer: {
           command: 'npm run dev',
           url: 'http://localhost:5173',
           reuseExistingServer: !process.env.CI,
           timeout: 120000,
         },
       });
       ```

    2. Create e2e/support/fixtures.ts with createBdd:
       ```typescript
       import { createBdd } from 'playwright-bdd';

       export const { Given, When, Then } = createBdd();
       ```

    Configuration notes per 01-CONTEXT.md decisions:
    - Headless by default (HEADLESS env var can override)
    - Viewport 1920x1080
    - Action timeout 10 seconds
    - HTML report opens automatically
    - Screenshots only on failure (no video)
    - Chromium only for now
  </action>
  <verify>
    - `cat playwright.config.ts` shows defineBddConfig import and usage
    - `cat e2e/support/fixtures.ts` shows createBdd export
    - `npx tsc --noEmit -p e2e/tsconfig.json` compiles without errors
  </verify>
  <done>Playwright configured with BDD integration, fixtures file exports Given/When/Then</done>
</task>

<task type="auto">
  <name>Task 3: Create smoke test and npm scripts</name>
  <files>
    - e2e/features/smoke/smoke.feature
    - e2e/features/smoke/steps.ts
    - package.json
  </files>
  <action>
    1. Create minimal smoke.feature to verify infrastructure:
       ```gherkin
       Feature: Smoke Test
         Verify E2E testing infrastructure works correctly

         @smoke
         Scenario: Application loads successfully
           Given I navigate to the home page
           Then I should see the game title
       ```

    2. Create e2e/features/smoke/steps.ts with step definitions:
       ```typescript
       import { expect } from '@playwright/test';
       import { Given, Then } from '../../support/fixtures';

       Given('I navigate to the home page', async ({ page }) => {
         await page.goto('/');
       });

       Then('I should see the game title', async ({ page }) => {
         // Check for game title - adjust selector based on actual app
         await expect(page.locator('body')).toBeVisible();
       });
       ```

    3. Add npm scripts to package.json:
       ```json
       {
         "scripts": {
           "test:e2e": "npx bddgen && npx playwright test",
           "test:e2e:headed": "npx bddgen && npx playwright test --headed",
           "test:e2e:debug": "npx bddgen && npx playwright test --debug",
           "test:e2e:ui": "npx bddgen && npx playwright test --ui"
         }
       }
       ```

    Note: The two-command pattern (bddgen then playwright) is the standard playwright-bdd workflow per research.
  </action>
  <verify>
    - `cat e2e/features/smoke/smoke.feature` shows valid Gherkin
    - `cat e2e/features/smoke/steps.ts` shows step definitions
    - `npm run test:e2e --help` (or similar) confirms script exists
    - `npx bddgen` runs without errors and creates .features-gen/ directory
  </verify>
  <done>Smoke test feature and steps created, npm scripts added, bddgen generates test files</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Run bddgen to verify feature-to-test conversion:
   ```bash
   npx bddgen
   ```
   Expected: Creates .features-gen/ directory with generated test files

2. Verify TypeScript compilation:
   ```bash
   npx tsc --noEmit -p e2e/tsconfig.json
   ```
   Expected: No errors

3. List generated files:
   ```bash
   ls -la .features-gen/
   ```
   Expected: Generated .spec.ts file from smoke.feature
</verification>

<success_criteria>
1. playwright-bdd ^8.4.2 and @playwright/test ^1.50 installed
2. e2e/ directory structure created with features/, pages/, support/
3. playwright.config.ts uses defineBddConfig pattern
4. e2e/support/fixtures.ts exports Given, When, Then from createBdd
5. Smoke test feature file and step definitions exist
6. npm run test:e2e script defined in package.json
7. npx bddgen succeeds and generates test files to .features-gen/
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-01-SUMMARY.md`
</output>
